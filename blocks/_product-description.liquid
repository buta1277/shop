{%- liquid
  unless product 
    assign product = section.settings.product
  endunless
  assign description_excerpt = block.settings.short_des | default: product.description
  if description_excerpt == blank
    continue 
  endif 
-%}

{%- if product.description != blank and block.settings.des == '1' -%}    
  <div class="hdt-product-info__item hdt-product__description sn-desc--{{ block.id }}" {{ block.shopify_attributes }}>
    <div class="hdt-s-text2 hdt-rte">
      {{ product.description }}
    </div>
  </div>
{%- elsif description_excerpt != blank -%}
  {%- if block.settings.readm == false -%}
    <div class="hdt-product-info__item hdt-product__description sn-desc--{{ block.id }}" {{ block.shopify_attributes }}>
      <div class="hdt-s-text2 hdt-rte">
        {{ description_excerpt }}
      </div>
    </div>
  {%- else -%}
    {%- assign height_limit = block.settings.length | abs -%}
    <product-description class="hdt-block hdt-product-description sn-desc--{{ block.id }}" data-height-limit="{{ height_limit }}" data-type="{{ block.type }}" {{ block.shopify_attributes }}>
      <div data-content class="hdt-product-info__item hdt-product__description hdt-relative hdt-oh">
        <div class="hdt-s-text2 hdt-rte hdt-full-des">
          {{ description_excerpt }}
        </div>
        <div class="hdt-description-overlay"></div>
      </div>
      <button data-button class="hdt-product__description_readm hdt-pr-des-rm hdt-btn hdt-btn-link">
        <span class="hdt-rm-text">{{ block.settings.readm_txt }}</span>
        <span class="hdt-rl-text hdt-hidden">{{ block.settings.readl_txt }}</span>
      </button>
    </product-description>
  {%- endif -%}
{%- endif -%}

{%- if block.settings.custom_css != blank -%}
  <style>
    /* 仅作用于：当前 Section + 当前这个描述块 */
    #shopify-section-{{ section.id }} .sn-desc--{{ block.id }}{
      /* 你也可以在 custom_css 中直接写更具体的选择器，无需改这里 */
    }

    /* ==== 以下是你在面板里要写的自定义 CSS 会被注入的位置 ==== */
    /* 示例（可以删掉示例，直接在面板里写你要的规则）：
       #shopify-section-{{ section.id }} .sn-desc--{{ block.id }} .hdt-rte h2{ font-size: 24px; line-height: 1.3; }
       #shopify-section-{{ section.id }} .sn-desc--{{ block.id }} .hdt-rte h3{ font-size: 20px; }
    */
    {{ block.settings.custom_css }}
  </style>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.main-product.blocks.description.name",
  "tag": null,
  "settings": [
    {
      "type": "select",
      "id": "des",
      "options": [
        {
          "value": "1",
          "label": "t:sections.main-product.blocks.description.settings.des.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.main-product.blocks.description.settings.des.options__2.label"
        }
      ],
      "label": "t:sections.main-product.blocks.description.settings.des.label",
      "info": "t:sections.main-product.blocks.description.settings.des.info",
      "default": "2"
    },
    {
      "type": "richtext",
      "id": "short_des",
      "label": "t:sections.main-product.blocks.description.settings.short_des.label",
      "info": "t:sections.main-product.blocks.description.settings.short_des.info",
      "visible_if": "{{ block.settings.des == '2' }}"
    },
    {
      "type": "checkbox",
      "id": "readm",
      "label": "t:sections.main-product.blocks.description.settings.readm.label",
      "info": "t:sections.main-product.blocks.description.settings.readm.info",
      "default": false,
      "visible_if": "{{ block.settings.des == '2' }}"
    },
    {
      "type": "number",
      "id": "length",
      "label": "Short description height",
      "info": "Number of height that will be displayed for product description (Only work when turned on [Use Read more])",
      "default": 30,
      "visible_if": "{{ block.settings.readm and block.settings.des == '2' }}"
    },
    {
      "type": "text",
      "id": "readm_txt",
      "label": "t:sections.main-product.blocks.description.settings.readm_txt.label",
      "default": "Read more",
      "visible_if": "{{ block.settings.readm and block.settings.des == '2' }}"
    },
    {
      "type": "text",
      "id": "readl_txt",
      "label": "t:sections.main-product.blocks.description.settings.readl_txt.label",
      "default": "Read less",
      "visible_if": "{{ block.settings.readm and block.settings.des == '2' }}"
    },
{
  "type": "textarea",
  "id": "custom_css",
  "label": "Custom CSS (this block only)",
  "info": "示例：.hdt-rte h2{font-size:24px;line-height:1.3}；该样式仅作用于当前描述块",
  "default": "/* Write custom CSS here */"
}


  ],
  "presets": [
    { 
      "name": "t:sections.main-product.blocks.description.name"
    }
  ]
}
{% endschema %}
